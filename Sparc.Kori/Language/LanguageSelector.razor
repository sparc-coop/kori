@using System.Net.Http.Json
@using System.Globalization

<div class="login-component__language">
    <button class="login-component__language-btn" @onclick=ToggleLanguageSettings>
        <div class="login-component__language-btn-content login-component__text-btn">
            <img src="_content/Kori/icons/Language.svg" /> @SelectedLanguage?.DisplayName
        </div>
        <img class="login-component__expand-icon @(ShowLanguageSettings ? "rotate": "")" src="_content/Kori/icons/Expand.svg" />
    </button>
    <ul class="login-component__language-list @(ShowLanguageSettings? "show" : "")">
        @if (Languages != null)
        {
            @foreach (var language in Languages.AllLanguages)
            {
                <li>
                    <button class="login-component__change-language-btn login-component__text-btn" @onclick=@(() => ChangeLanguage(language))>
                        @language.DisplayName

                        @if (language.DisplayName != language.NativeName)
                        {
                            <aside>@language.NativeName</aside>
                        }

                        @* @if (User.Language == language.Id)
                {
                <div class="right">
                <img src="icons/Check.svg" />
                </div>
                }
                *@
                    </button>
                </li>
            }
        }
    </ul>
</div> 

@inject KoriLanguageEngine Languages
@code {
    [Parameter] public KoriLanguage? SelectedLanguage { get; set; }
    [Parameter] public EventCallback<KoriLanguage> LanguageChanged { get; set; }
    bool ShowLanguageSettings = false;

    protected override async Task OnInitializedAsync()
    {
        await Languages.InitializeAsync(SelectedLanguage);
    }

    async Task ChangeLanguage(KoriLanguage language)
    {
        await Languages.InitializeAsync(language);
        ToggleLanguageSettings();
    }

    void ToggleLanguageSettings()
    {
        ShowLanguageSettings = !ShowLanguageSettings;
    }

}